(function(i){var b;Modernizr.addTest("csstransformspreserve3d",function(){var k=Modernizr.prefixed("transformStyle");var l="preserve-3d";var j;if(!k){return false}k=k.replace(/([A-Z])/g,function(n,m){return"-"+m.toLowerCase()}).replace(/^ms-/,"-ms-");Modernizr.testStyles("#modernizr{"+k+":"+l+";}",function(m,n){j=i.getComputedStyle?getComputedStyle(m,null).getPropertyValue(k):""});return(j===l)});var f={transitions:Modernizr.csstransitions,preserve3d:Modernizr.csstransformspreserve3d},h={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},g=h[Modernizr.prefixed("transition")];function a(j,k){for(var l in k){if(k.hasOwnProperty(l)){j[l]=k[l]}}return j}function e(q){var l=[],r=q.length,n=q[0].length;for(var m=0;m<r;m++){l=l.concat(q[m])}l=d(l);var s=[],t=0;for(var o=0;o<r;o++){var u=[];for(var p=0;p<n;p++){u.push(l[t]);t++}s.push(u)}return s}function d(j){var l=j.length,n,k;while(l){k=Math.floor(Math.random()*l--);n=j[l];j[l]=j[k];j[k]=n}return j}function c(j,k){this.el=j;this.inner=this.el.querySelector("div");this.allItems=[].slice.call(this.inner.children);this.allItemsCount=this.allItems.length;if(!this.allItemsCount){return}this.items=[].slice.call(this.inner.querySelectorAll("div.portfolio-block:not([data-dummy])"));this.itemsCount=this.items.length;b=this.items.length-1;this.current=0;this.options=a({},this.options);a(this.options,k);this._init()}c.prototype.options={};c.prototype._init=function(){this.currentItem=this.items[this.current];this._addNavigation();this._getSizes();this._initEvents()};c.prototype._addNavigation=function(){this.wrapper=document.createElement("div");this.wrapper.className="gfort-photostack-nav-wrapper";this.prevArrow=document.createElement("span");this.prevArrow.className="gfort-photostack-prev";this.nextArrow=document.createElement("span");this.nextArrow.className="gfort-photostack-next";this.nav=document.createElement("nav");var k="";for(var j=0;j<this.itemsCount;++j){k+="<span></span>"}this.nav.innerHTML=k;this.wrapper.appendChild(this.prevArrow);this.wrapper.appendChild(this.nav);this.wrapper.appendChild(this.nextArrow);this.el.appendChild(this.wrapper);this.navDots=[].slice.call(this.nav.children);this.navperv=[].slice.call(this.prevArrow);this.navnext=[].slice.call(this.nextArrow)};c.prototype._initEvents=function(){var l=this,j=classie.hasClass(this.el,"photostack-start"),k=function(){var m=function(){if(f.transitions){classie.addClass(l.el,"photostack-transition")}};if(j){this.removeEventListener("click",k);classie.removeClass(l.el,"photostack-start");m()}else{l.openDefault=true;setTimeout(m,25)}l.started=true;l._showPhoto(l.current)};if(j){this._shuffle();this.el.addEventListener("click",k)}else{k()}jQuery(this.nextArrow).on("click",function(){var n=l.current;if(n===b){n=0;var m=function(){l._showPhoto(n)}}else{n=n+1;var m=function(){l._showPhoto(n)}}m()});jQuery(this.prevArrow).on("click",function(){var n=l.current;event.preventDefault();if(n===0){n=b;var m=function(){l._showPhoto(n)}}else{n=n-1;var m=function(){l._showPhoto(n)}}m()});this.navDots.forEach(function(m,n){m.addEventListener("click",function(){if(n===l.current){l._rotateItem()}else{var o=function(){l._showPhoto(n)};if(l.flipped){l._rotateItem(o)}else{o()}}})});i.addEventListener("resize",function(){l._resizeHandler()})};c.prototype._resizeHandler=function(){var k=this;function j(){k._resize();k._resizeTimeout=null}if(this._resizeTimeout){clearTimeout(this._resizeTimeout)}this._resizeTimeout=setTimeout(j,100)};c.prototype._resize=function(){var k=this,j=function(){k._shuffle(true)};this._getSizes();if(this.started&&this.flipped){this._rotateItem(j)}else{j()}};c.prototype._showPhoto=function(j){if(this.isShuffling){return false}this.isShuffling=true;if(classie.hasClass(this.currentItem,"photostack-flip")){this._removeItemPerspective();classie.removeClass(this.navDots[this.current],"flippable")}classie.removeClass(this.navDots[this.current],"current");classie.removeClass(this.currentItem,"photostack-current");this.current=j;this.currentItem=this.items[this.current];classie.addClass(this.navDots[this.current],"current");if(this.currentItem.querySelector(".photostack-back")){classie.addClass(this.navDots[j],"flippable")}this._shuffle()};c.prototype._shuffle=function(u){var o=u?1:this.currentItem.getAttribute("data-shuffle-iteration")||1;if(o<=0||!this.started||this.openDefault){o=1}if(this.openDefault){classie.addClass(this.currentItem,"photostack-flip");this.openDefault=false;this.isShuffling=false}var t=0.5,p=Math.ceil(this.sizes.inner.width/(this.sizes.item.width*t)),l=Math.ceil(this.sizes.inner.height/(this.sizes.item.height*t)),j=p*this.sizes.item.width*t+this.sizes.item.width/2-this.sizes.inner.width,k=l*this.sizes.item.height*t+this.sizes.item.height/2-this.sizes.inner.height,m=j/2,n=k/2,q=35,r=-35,v=this,s=function(){--o;var z=[];for(var A=0;A<l;++A){var y=z[A]=[];for(var B=0;B<p;++B){var H=B*(v.sizes.item.width*t)-m,I=A*(v.sizes.item.height*t)-n,E=0,F=0;if(v.started&&o===0){var D=v._isOverlapping({x:H,y:I});if(D.overlapping){E=D.noOverlap.x;F=D.noOverlap.y;var G=Math.floor(Math.random()*3);switch(G){case 0:E=0;break;case 1:F=0;break}}}y[B]={x:H+E,y:I+F}}}z=e(z);var C=0,w=0,x=0;v.allItems.forEach(function(L,K){if(C===p-1){w=w===l-1?0:w+1;C=1}else{++C}var N=Math.floor(Math.random()*p),O=Math.floor(Math.random()*l),J=z[w][C-1],P={x:J.x,y:J.y},M=function(){++x;if(f.transitions){this.removeEventListener(g,M)}if(x===v.allItemsCount){if(o>0){s.call()}else{classie.addClass(v.currentItem,"photostack-flip");v.isShuffling=false;if(typeof v.options.callback==="function"){v.options.callback(v.currentItem)}}}};if(v.items.indexOf(L)===v.current&&v.started&&o===0){v.currentItem.style.WebkitTransform="translate("+v.centerItem.x+"px,"+v.centerItem.y+"px) rotate(0deg)";v.currentItem.style.msTransform="translate("+v.centerItem.x+"px,"+v.centerItem.y+"px) rotate(0deg)";v.currentItem.style.transform="translate("+v.centerItem.x+"px,"+v.centerItem.y+"px) rotate(0deg)";if(v.currentItem.querySelector(".photostack-back")){v._addItemPerspective()}classie.addClass(v.currentItem,"photostack-current")}else{L.style.WebkitTransform="translate("+P.x+"px,"+P.y+"px) rotate("+Math.floor(Math.random()*(q-r+1)+r)+"deg)";L.style.msTransform="translate("+P.x+"px,"+P.y+"px) rotate("+Math.floor(Math.random()*(q-r+1)+r)+"deg)";L.style.transform="translate("+P.x+"px,"+P.y+"px) rotate("+Math.floor(Math.random()*(q-r+1)+r)+"deg)"}if(v.started){if(f.transitions){L.addEventListener(g,M)}else{M()}}})};s.call()};c.prototype._getSizes=function(){this.sizes={inner:{width:this.inner.offsetWidth,height:this.inner.offsetHeight},item:{width:this.currentItem.offsetWidth,height:this.currentItem.offsetHeight}};this.centerItem={x:this.sizes.inner.width/2-this.sizes.item.width/2,y:this.sizes.inner.height/2-this.sizes.item.height/2}};c.prototype._isOverlapping=function(o){var k=this.sizes.item.width+this.sizes.item.width/3,m=this.sizes.item.height+this.sizes.item.height/3,j={x:this.sizes.inner.width/2-k/2,y:this.sizes.inner.height/2-m/2},l=this.sizes.item.width,n=this.sizes.item.height;if(!((o.x+l)<j.x||o.x>(j.x+k)||(o.y+n)<j.y||o.y>(j.y+m))){var p=Math.random()<0.5,s=Math.floor(Math.random()*(l/4+1)),t=Math.floor(Math.random()*(n/4+1)),q=p?(o.x-j.x+l)*-1-s:(j.x+k)-(o.x+l)+l+s,r=p?(o.y-j.y+n)*-1-t:(j.y+m)-(o.y+n)+n+t;return{overlapping:true,noOverlap:{x:q,y:r}}}return{overlapping:false}};c.prototype._addItemPerspective=function(){classie.addClass(this.el,"photostack-perspective")};c.prototype._removeItemPerspective=function(){classie.removeClass(this.el,"photostack-perspective");classie.removeClass(this.currentItem,"photostack-flip")};c.prototype._rotateItem=function(j){if(classie.hasClass(this.el,"photostack-perspective")&&!this.isRotating&&!this.isShuffling){this.isRotating=true;var l=this,k=function(){if(f.transitions&&f.preserve3d){this.removeEventListener(g,k)}l.isRotating=false;if(typeof j==="function"){j()}};if(this.flipped){classie.removeClass(this.navDots[this.current],"flip");if(f.preserve3d){this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)";this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)"}else{classie.removeClass(this.currentItem,"photostack-showback")}}else{classie.addClass(this.navDots[this.current],"flip");if(f.preserve3d){this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)";this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)"}else{classie.addClass(this.currentItem,"photostack-showback")}}this.flipped=!this.flipped;if(f.transitions&&f.preserve3d){this.currentItem.addEventListener(g,k)}else{k()}}};i.Photostack=c})(window);